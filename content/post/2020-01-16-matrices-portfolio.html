---
title: Matrices Portfolio
author: Mauro Camara Escudero
date: '2020-01-16'
slug: matrices-portfolio
categories:
  - R
  - matrices
tags:
  - matrices
  - sparse matrices
  - kaggle
  - spotify
keywords:
  - tech
---



<pre class="r"><code>library(Matrix)
library(tidyverse)
library(igraph)</code></pre>
<p>We work with the same dataset used for <code>Tidyverse</code> containing data regarding some of the top-voted kaggle kernels.</p>
<pre class="r"><code>kaggle &lt;- read_csv(&quot;kagglekernels.csv&quot;, col_types = cols(
  Votes=col_double(),
  Owner=col_factor(),
  Kernel=col_factor(),
  Dataset=col_factor(),
  Output=col_character(),
  `Code Type`=col_factor(),
  Language=col_factor(),
  Comments=col_double(),
  Views=col_double(),
  Forks=col_double()
))
kaggle # Tibbles automatically print head(tibble)</code></pre>
<pre><code>## # A tibble: 971 x 12
##    Votes Owner Kernel Dataset `Version Histor… Tags  Output `Code Type` Language
##    &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;   &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;  &lt;fct&gt;       &lt;fct&gt;   
##  1  2130 Mega… Explo… Titani… Version 8,2017-… tuto… This … Script      markdown
##  2  1395 Guid… Full … Data S… Version 19,2017… tuto… This … Notebook    Python  
##  3  1363 Pedr… Compr… House … Version 47,2018… begi… This … Notebook    Python  
##  4  1316 Anis… Intro… Titani… Version 93,2018… tuto… This … Notebook    Python  
##  5  1078 Kaan… Data … Pokemo… Version 389,201… begi… This … Notebook    Python  
##  6  1003 Phil… Explo… Zillow… Version 44,2017… begi… This … Script      markdown
##  7   946 Mana… Titan… Titani… Version 16,2017… tuto… This … Notebook    Python  
##  8   826 Omar… A Jou… Titani… Version 6,2016-… begi… This … Notebook    Python  
##  9   814 anok… Data … Quora … &lt;NA&gt;             inte… This … Notebook    Python  
## 10   726 SRK   Simpl… Zillow… Version 19,2017… eda,… This … Notebook    Python  
## # … with 961 more rows, and 3 more variables: Comments &lt;dbl&gt;, Views &lt;dbl&gt;,
## #   Forks &lt;dbl&gt;</code></pre>
<p>Again, we can use the <code>Tags</code> to create a number of different new variables, each representing one <code>Tag</code>.</p>
<pre class="r"><code># stop here in order to have the column names
tagmatrix &lt;- kaggle  %&gt;% 
    dplyr::select(Tags) %&gt;%  
    mutate(rn=row_number()) %&gt;%             
    separate_rows(Tags, sep=&quot;\\s*,\\s*&quot;) %&gt;%  # RegEx comma-separated tags
    mutate(i1=1) %&gt;%                          # Uniquely identifies rows together with rn
    mutate_all(~na_if(., &quot;&quot;)) %&gt;%             # remove NA generated by &quot;&lt;tag&gt;,&quot;
    pivot_wider(names_from = Tags, 
                values_from = i1,
                values_fill = list(i1 = 0)) %&gt;% # Wide format
    dplyr::select(-rn, -&quot;NA&quot;)
tagmatrix</code></pre>
<pre><code>## # A tibble: 971 x 101
##    tutorial beginner `feature engine… preprocessing   eda `data cleaning`
##       &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;
##  1        1        1                1             0     0               0
##  2        1        0                0             1     0               0
##  3        0        1                0             0     1               1
##  4        1        0                0             0     0               0
##  5        0        1                0             0     0               0
##  6        0        1                0             0     1               0
##  7        1        0                1             0     0               0
##  8        0        1                0             0     1               0
##  9        0        0                0             0     1               0
## 10        0        0                0             0     1               0
## # … with 961 more rows, and 95 more variables: ensembling &lt;dbl&gt;, xgboost &lt;dbl&gt;,
## #   `data visualization` &lt;dbl&gt;, `model comparison` &lt;dbl&gt;, `random
## #   forest` &lt;dbl&gt;, `logistic regression` &lt;dbl&gt;, intermediate &lt;dbl&gt;, nlp &lt;dbl&gt;,
## #   `regression analysis` &lt;dbl&gt;, `time series` &lt;dbl&gt;, `geospatial
## #   analysis` &lt;dbl&gt;, `linear regression` &lt;dbl&gt;, advanced &lt;dbl&gt;, cnn &lt;dbl&gt;,
## #   classification &lt;dbl&gt;, `neural networks` &lt;dbl&gt;, linguistics &lt;dbl&gt;, `survey
## #   analysis` &lt;dbl&gt;, `dimensionality reduction` &lt;dbl&gt;, pca &lt;dbl&gt;, `image
## #   processing` &lt;dbl&gt;, `deep learning` &lt;dbl&gt;, storytelling &lt;dbl&gt;,
## #   databases &lt;dbl&gt;, bigquery &lt;dbl&gt;, learning &lt;dbl&gt;, crime &lt;dbl&gt;,
## #   finance &lt;dbl&gt;, forecasting &lt;dbl&gt;, healthcare &lt;dbl&gt;, `gradient
## #   boosting` &lt;dbl&gt;, rnn &lt;dbl&gt;, animation &lt;dbl&gt;, geography &lt;dbl&gt;,
## #   terrorism &lt;dbl&gt;, `model diagnosis` &lt;dbl&gt;, `k-means` &lt;dbl&gt;, `food and
## #   drink` &lt;dbl&gt;, `decision tree` &lt;dbl&gt;, animals &lt;dbl&gt;, `recommender
## #   systems` &lt;dbl&gt;, `video games` &lt;dbl&gt;, demographics &lt;dbl&gt;, internet &lt;dbl&gt;,
## #   basketball &lt;dbl&gt;, sports &lt;dbl&gt;, optimization &lt;dbl&gt;, `marketing
## #   analytics` &lt;dbl&gt;, cricket &lt;dbl&gt;, politics &lt;dbl&gt;, biology &lt;dbl&gt;, `network
## #   analysis` &lt;dbl&gt;, `pipeline code` &lt;dbl&gt;, languages &lt;dbl&gt;, education &lt;dbl&gt;,
## #   `machine learning` &lt;dbl&gt;, gan &lt;dbl&gt;, regression &lt;dbl&gt;, business &lt;dbl&gt;,
## #   marketing &lt;dbl&gt;, clustering &lt;dbl&gt;, `5daychallenge` &lt;dbl&gt;, svm &lt;dbl&gt;,
## #   lstm &lt;dbl&gt;, `image data` &lt;dbl&gt;, `object segmentation` &lt;dbl&gt;,
## #   statistics &lt;dbl&gt;, housing &lt;dbl&gt;, economics &lt;dbl&gt;, `text mining` &lt;dbl&gt;,
## #   banking &lt;dbl&gt;, memory &lt;dbl&gt;, `association football` &lt;dbl&gt;, violence &lt;dbl&gt;,
## #   `visual arts` &lt;dbl&gt;, history &lt;dbl&gt;, `bayesian statistics` &lt;dbl&gt;,
## #   cities &lt;dbl&gt;, `united states` &lt;dbl&gt;, `occupational safety` &lt;dbl&gt;,
## #   programming &lt;dbl&gt;, countries &lt;dbl&gt;, immigration &lt;dbl&gt;, `universities and
## #   colleges` &lt;dbl&gt;, `auto racing` &lt;dbl&gt;, probability &lt;dbl&gt;, `programming
## #   languages` &lt;dbl&gt;, plants &lt;dbl&gt;, firefighting &lt;dbl&gt;, `stochastic
## #   processes` &lt;dbl&gt;, safety &lt;dbl&gt;, `outlier analysis` &lt;dbl&gt;, weather &lt;dbl&gt;,
## #   `signal processing` &lt;dbl&gt;, `reinforcement learning` &lt;dbl&gt;</code></pre>
<p>Each column now has <code>1</code>s where the Kernels were tagged with that specific tag, and <code>0</code> otherwise. Data in this form is not very useful for a graph representation. Instead, we can create an adjecency matrix having tags on columns and on rows and where the entries correspond to the number of times the pair of tags was used together in the same kernel. In order to count this metric, we can leverage the <code>crossprod</code> function. We also transform <code>tagmatrix</code>, which is a <code>tibble</code>, into a sparseMatrix.</p>
<pre class="r"><code>tagmatrix %&lt;&gt;%
  as.matrix %&gt;% 
  Matrix::Matrix(sparse=TRUE) %&gt;% 
  Matrix::crossprod() %&gt;%         # Preserves sparsity
  `diag&lt;-`(0) %&gt;%         # A Tag is not related with itself
  Matrix::drop0()</code></pre>
<p>We can look at the sparsity pattern with the function <code>Matrix::image()</code> to get an idea of what this matrix looks like.</p>
<pre class="r"><code>Matrix::image(tagmatrix, main=&quot;Sparsity Patter of Tag Pairings&quot;)</code></pre>
<p><img src="/post/2020-01-16-matrices-portfolio_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Alternatively, we can look at the percentage of sparsity.</p>
<pre class="r"><code>nnzero(tagmatrix) / length(tagmatrix)</code></pre>
<pre><code>## [1] 0.08214881</code></pre>
<p>We now proceed to use the <code>igraph</code> package to plot a network using <code>tagmatrix</code> as a weighted adjecency matrix. Since the matrix is very large, we restrict ourselves to the most “social” tags, i.e. tags that have been paired with other tags more than a given number of times, in this case <code>5</code>. To do this, we set those values to zero and then drop the corresponding column and rows (since <code>tagmatrix</code> is symmetric).</p>
<pre class="r"><code># set values below a threshold to 0
tagmatrix[tagmatrix&lt;=5] &lt;- 0
# drop empty rows and columns for graphing purposes
flag &lt;- apply(tagmatrix, 1, function(x) any(x != 0))
tagmatrix &lt;- tagmatrix[flag, flag]
# value corresponds to how &quot;social&quot; those tags are
graph &lt;- graph_from_adjacency_matrix(tagmatrix, weighted = TRUE)</code></pre>
<p>We first choose to plot the network using a standard circle layout.</p>
<pre class="r"><code>plot(graph, layout=layout_in_circle(graph), vertex.label.cex=1.0,
     edge.arrow.size=1.0, vertex.label.color=&quot;black&quot;, vertex.size=24)</code></pre>
<p><img src="/post/2020-01-16-matrices-portfolio_files/figure-html/unnamed-chunk-8-1.png" width="1440" /></p>
<p>While at first this graph looks insightful, it’s hard to see some structure. Rather, we can specify a layout by choosing ourselves the coordinates of each node. After some trail and error, it’s possible to come up with a layout similar to this one.</p>
<pre class="r"><code># graph
layout &lt;- matrix(c(0, 1, 1, 0, -1, 2, 3, -1, 3, 4, 4, 1, 1, -1, 2, 0, 3, 4, 4,
                   0, 1, 2, 2,  2, 1, 2,  1, 0, 0, 2, 3, 0,  0, 0, 3, 3, 3, 1), nrow=19, ncol=2)
plot(graph, layout=layout, vertex.label.cex=1.0, edge.arrow.size=1.0, 
     vertex.label.color=&quot;black&quot;, vertex.size=24)</code></pre>
<p><img src="/post/2020-01-16-matrices-portfolio_files/figure-html/unnamed-chunk-9-1.png" width="1440" /></p>
<p>We can see a few important features. First of all it looks like there are three main clusters. One is about <em>deep learning</em>, one is about <em>finance and crime</em> data and the other cluster gathers together most other variables. In this latter cluster, we can see that <code>data visualization</code> dominates.</p>
